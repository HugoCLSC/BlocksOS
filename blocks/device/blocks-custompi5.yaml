# METABEGIN
# X-Env-Layer-Name: blocks-custompi5
# X-Env-Layer-Category: device
# X-Env-Layer-Desc: Raspberry Pi 5 specific device layer
# X-Env-Layer-Version: 0.0.1
# X-Env-Layer-Requires: device-base,
#  rpi-boot-firmware,
#  rpi-linux-2712,
#  debian-trixie-arm64-multi,
#  rpi-debian-trixie,
#  rpi-misc-utils,
#  rpi-misc-skel,
#  rpi-user-credentials, 
#  build-tools, 
#  systemd-net-min,
#  rpi-linux-v8,
#  openssh-server
# X-Env-Layer-Provides: device
#
# X-Env-VarPrefix: device
#
# X-Env-Var-class: pi5
# X-Env-Var-class-Desc: Device class
# X-Env-Var-class-Required: n
# X-Env-Var-class-Valid: keywords: pi5
# X-Env-Var-class-Set: y
#
# X-Env-Var-storage_type: sd
# X-Env-Var-storage_type-Desc: Pi5 storage type.
# X-Env-Var-storage_type-Required: n
# X-Env-Var-storage_type-Valid: sd,nvme
# X-Env-Var-storage_type-Set: y
#
# X-Env-Var-assetdir: ${DIRECTORY}
# X-Env-Var-assetdir-Desc: Directory for device assets
# X-Env-Var-assetdir-Required: n
# X-Env-Var-assetdir-Valid: string
# X-Env-Var-assetdir-Set: y
# METAEND
---
mmdebstrap:
  packages:
    - udev 
    - raspi-firmware
    - linux-image-rpi-v8
    - firmware-brcm80211
  #dpkgopts:
  #  - path-exclude=/usr/lib/raspi-firmware/*
  # - path-include=/usr/lib/raspi-firmware/LICENCE.broadcom
  # - path-exclude=/usr/lib/linux-image-*-v8/broadcom/bcm2710*
  # - path-exclude=/usr/lib/linux-image-*-v8/broadcom/bcm2711*
  # - path-exclude=/usr/lib/linux-image-*-v8/broadcom/bcm2837*
  # - path-exclude=/usr/share/doc/firmware-brcm80211/
  # - path-include=/usr/share/doc/firmware-brcm80211/copyright
  # - path-exclude=/lib/firmware/cypress/*
  # - path-include=/lib/firmware/cypress/cyfmac43455*
  # - path-exclude=/lib/firmware/brcm/*
  # - path-include=/lib/firmware/brcm/brcmfmac43455-sdio.raspberrypi,5*
  # - path-include=/lib/firmware/brcm/brcmfmac43455-sdio.txt
  # - path-include=/lib/firmware/brcm/BCM4345C0.raspberrypi,5*
  customize-hooks:
    - mkdir -p $1/boot/firmware
    - ln -sf firmware/overlays $1/boot/overlays
    - install -m 644 ${IGconf_device_assetdir}/cmdline.txt $1/boot/firmware/
    - install -m 644 ${IGconf_device_assetdir}/config.txt $1/boot/firmware/
