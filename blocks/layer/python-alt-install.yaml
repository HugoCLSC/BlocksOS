# METABEGIN
# X-Env-Layer-Name: python-alt-layer
# X-Env-Layer-Category: language
# X-Env-Layer-Desc: Installs Python 3.11.2 as alternate version from source
# X-Env-Layer-Version: 1.0.0
# METAEND
---


mmdebstrap:
  setup-hooks:
    - echo "Running custom installation of Python version 3.11.2"
  customize-hooks:
    - |
      echo "[python-alt-layer] Downloading Python 3.11.2 from source..."
      mkdir -p /tmp/python-src/
      cd /tmp/python-src/
      wget https://www.python.org/ftp/python/3.11.2/Python-3.11.2.tgz
      tar xzf Python-3.11.2.tgz

    - | 
      echo "[python-alt-layer] Building Python 3.11.2..."
      cd /tmp/python-src/Python-3.11.2
      
      sudo chmod +x /tmp/python-src/Python-3.11.2/configure
      sh /tmp/python-src/Python-3.11.2/configure --enable-optimizations --prefix=/usr/local/python3.11
      make -j$(nproc)
      make altinstall

    - | 
      echo "[python-alt-layer] Creating symlink for Python 3.11.2 ..."
      ln -s /usr/local/python3.11/bin/python3.11 /usr/local/bin/python3.11
      ln -s /usr/local/python3.11/bin/pip3.11 /usr/local/bin/pip3.11

  # cleanup-hooks:
  #   - |
  #     echo "[custom-firmware] Cleaning up..."
  #     rm -rf /usr/src/Python-3.11.2*

  packages:
  - build-essential
  - libssl-dev
  - zlib1g-dev
  - libncurses5-dev
  - libncursesw5-dev
  - libreadline-dev
  - libsqlite3-dev
  - libgdbm-dev
  - libdb5.3-dev
  - libbz2-dev
  - libexpat1-dev
  - liblzma-dev
  - tk-dev
  - wget
  
